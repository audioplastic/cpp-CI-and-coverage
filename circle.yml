checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install cmake; sudo apt-get install gcov

test:
  pre:
    - g++ -v && gcov -version && cmake -version
    - mkdir build
    - cd build && cmake .. -DBUILD_TESTS=ON -DCOVERALLS=Oon -DCMAKE_BUILD_TYPE=Debug
    - cd build && cmake --build .
    - cd build && cmake --build . --target coveralls
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/gtest
    - build/test/all_tests --gtest_output=xml:$CIRCLE_TEST_REPORTS/gtest/gtest.xml
  post:
    - cd build && ls -l src && bash <(curl -s https://codecov.io/bash) -psrc